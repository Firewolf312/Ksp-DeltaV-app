<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kerbal Delta-V Designer ULTRA AI</title>
<style>
body{font-family:Arial;background:#0b0f1a;color:white;margin:0;padding:20px;overflow-x:hidden}
.container{max-width:1200px;margin:auto;background:#111827;padding:20px;border-radius:16px;box-shadow:0 0 40px #000}
h1{text-align:center}
.section{margin-bottom:20px}
select,input,button{padding:10px;border-radius:8px;border:none;margin:5px 0}
button{background:#2563eb;color:white;font-weight:bold;cursor:pointer}
button:hover{background:#1d4ed8}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.engine-card{background:#1f2937;padding:15px;border-radius:12px;text-align:center}
.result{margin-top:20px;font-size:18px}
.good{color:#22c55e}
.bad{color:#ef4444}
.progress{height:20px;background:#222;border-radius:10px;overflow:hidden;margin-top:10px}
.bar{height:100%;background:#22c55e}
.big-button{width:100%;font-size:18px;padding:14px;margin-top:10px}
.mode-toggle{display:flex;gap:10px;margin-top:10px}
.mode-toggle button{flex:1}
.hidden{display:none}
.ai-box{background:#0f172a;border-left:4px solid #38bdf8;padding:15px;border-radius:8px;margin-top:15px}
small{opacity:0.7}
</style>
</head>
<body>

<div class="container">
<h1>ðŸš€ Kerbal Delta-V Designer ULTRA AI</h1>

<div class="section">
<label><b>Rocket Tech Tier</b></label><br>
<select id="tierSelect" onchange="updateEngineLists()">
<option value="1">Tier 1 â€“ Early Career</option>
<option value="2">Tier 2 â€“ Mid Career</option>
<option value="3">Tier 3 â€“ Advanced</option>
<option value="4">Tier 4 â€“ Late Game / Nuclear</option>
</select>
</div>

<div class="section">
<label><b>Payload Mass (tons)</b></label><br>
<input type="number" id="payload" value="50" step="1">
</div>

<div class="section">
<label><b>Mission Profile (Pinâ€‘Point Î”v)</b></label><br>
<select id="mission">
<option value="3400">Kerbin Orbit (LKO precise 3400 m/s)</option>
<option value="4500">Mun Flyby (4500 m/s)</option>
<option value="5800">Mun Landing (5800 m/s)</option>
<option value="5400">Minmus Landing (5400 m/s)</option>
<option value="6200">Gilly Landing (6200 m/s)</option>
<option value="7000">Duna Orbit (7000 m/s)</option>
<option value="9000">Duna Landing (9000 m/s)</option>
<option value="8200">Eve Orbit (8200 m/s)</option>
<option value="12000">Eve Landing (12000 m/s VERY HARD)</option>
<option value="9500">Jool Orbit (9500 m/s)</option>
<option value="11000">Laythe Landing (11000 m/s)</option>
<option value="15000">Moho Orbit (15000 m/s)</option>
<option value="20000">Moho Landing (20000 m/s)</option>
<option value="6000">Solar Orbit Escape (6000 m/s from LKO)</option>
<option value="14000">Solar System Grand Tour (14000 m/s)</option>
</select>
<br>
<small>Values include launch + transfer + capture + landing margins.</small>
</div>

<div class="mode-toggle">
<button onclick="setMode('auto')">AUTO DESIGN</button>
<button onclick="setMode('manual')">MANUAL DESIGN</button>
</div>

<div id="autoSection">
<button class="big-button" onclick="autoDesign()">AUTO DESIGN ROCKET</button>
</div>

<div id="manualSection" class="hidden">
<div class="grid">
<div>
<label><b>Launch Engine</b></label><br>
<select id="manualLaunch"></select><br>
<label>Launch Fuel (tons)</label><br>
<input type="number" id="manualLaunchFuel" value="100">
</div>
<div>
<label><b>Vacuum Engine</b></label><br>
<select id="manualVac"></select><br>
<label>Vacuum Fuel (tons)</label><br>
<input type="number" id="manualVacFuel" value="40">
</div>
</div>
<button class="big-button" onclick="manualDesign()">CALCULATE MANUAL ROCKET</button>
</div>

<div class="grid" style="margin-top:20px">
<div class="engine-card" id="launchStage"></div>
<div class="engine-card" id="vacStage"></div>
</div>

<div class="result" id="output"></div>
<div class="progress"><div id="dvBar" class="bar" style="width:0%"></div></div>

<div class="ai-box" id="aiAdvice">
<b>ðŸ§  Flight AI:</b><br>
Awaiting rocket analysis...
</div>

</div>

<script>
const g = 9.81;

const engines = [
{name:"Ant", isp:315, thrust:2, mass:0.02, tier:1},
{name:"Spider", isp:290, thrust:2, mass:0.02, tier:1},
{name:"Swivel", isp:320, thrust:215, mass:1.5, tier:1},
{name:"Terrier", isp:345, thrust:60, mass:0.5, tier:2},
{name:"Skipper", isp:320, thrust:650, mass:3, tier:2},
{name:"Mainsail", isp:310, thrust:1500, mass:6, tier:3},
{name:"Vector", isp:315, thrust:1000, mass:4, tier:3},
{name:"Rhino", isp:340, thrust:2000, mass:9, tier:3},
{name:"Mammoth", isp:315, thrust:4000, mass:15, tier:4},
{name:"Nerv", isp:800, thrust:60, mass:3, tier:4}
];

const manualLaunch=document.getElementById("manualLaunch");
const manualVac=document.getElementById("manualVac");

function getAvailableEngines(){
const selectedTier=parseInt(document.getElementById("tierSelect").value);
return engines.filter(e=>e.tier<=selectedTier);
}

function updateEngineLists(){
manualLaunch.innerHTML="";
manualVac.innerHTML="";
getAvailableEngines().forEach((e)=>{
let opt1=document.createElement("option");
opt1.value=engines.indexOf(e);
opt1.textContent=e.name;
manualLaunch.appendChild(opt1);
let opt2=document.createElement("option");
opt2.value=engines.indexOf(e);
opt2.textContent=e.name;
manualVac.appendChild(opt2);
});
}

updateEngineLists();

function setMode(mode){
document.getElementById("autoSection").classList.toggle("hidden",mode!=="auto");
document.getElementById("manualSection").classList.toggle("hidden",mode!=="manual");
}

function autoDesign(){
const payload=parseFloat(document.getElementById("payload").value);
const requiredDV=parseFloat(document.getElementById("mission").value);
const available=getAvailableEngines();
let vacEngine=available.reduce((a,b)=> a.isp>b.isp?a:b);
let launchEngine=available.reduce((a,b)=> a.thrust>b.thrust?a:b);
let vacFuel=calculateFuel(vacEngine,payload,requiredDV*0.6);
let vacMass=payload+vacEngine.mass+vacFuel;
let launchFuel=calculateFuel(launchEngine,vacMass,requiredDV*0.4);
renderRocket(payload,requiredDV,launchEngine,launchFuel,vacEngine,vacFuel);
}

function manualDesign(){
const payload=parseFloat(document.getElementById("payload").value);
const requiredDV=parseFloat(document.getElementById("mission").value);
let launchEngine=engines[manualLaunch.value];
let vacEngine=engines[manualVac.value];
let launchFuel=parseFloat(document.getElementById("manualLaunchFuel").value);
let vacFuel=parseFloat(document.getElementById("manualVacFuel").value);
renderRocket(payload,requiredDV,launchEngine,launchFuel,vacEngine,vacFuel);
}

function renderRocket(payload,requiredDV,launchEngine,launchFuel,vacEngine,vacFuel){
let vacMass=payload+vacEngine.mass+vacFuel;
let totalMass=vacMass+launchEngine.mass+launchFuel;
let vacDV=vacEngine.isp*g*Math.log((payload+vacEngine.mass+vacFuel)/(payload+vacEngine.mass));
let launchDV=launchEngine.isp*g*Math.log((totalMass)/(vacMass));
let totalDV=vacDV+launchDV;
let percent=Math.min((totalDV/requiredDV)*100,100);
document.getElementById("dvBar").style.width=percent+"%";
document.getElementById("dvBar").style.background= totalDV>=requiredDV?"#22c55e":"#ef4444";
let TWR=(launchEngine.thrust*1000)/(totalMass*g);
let length=(launchFuel/8)+(vacFuel/8)+(launchEngine.mass*0.5)+(vacEngine.mass*0.5)+5;
let aiMessage="";
if(totalDV < requiredDV){ aiMessage += "You are missing Î”v for this mission profile.<br>"; }
if(TWR < 1.3){ aiMessage += "Launch TWR is marginal for Kerbin ascent.<br>"; }
if(length > 70){ aiMessage += "Rocket extremely tall. Structural instability likely.<br>"; }
if(aiMessage === ""){ aiMessage = "Rocket meets precise mission requirements."; }

document.getElementById("vacStage").innerHTML=`<h3>Vacuum Stage</h3><p>Engine: ${vacEngine.name}</p><p>Fuel: ${vacFuel.toFixed(1)} t</p><p>Î”v: ${vacDV.toFixed(0)} m/s</p>`;
document.getElementById("launchStage").innerHTML=`<h3>Launch Stage</h3><p>Engine: ${launchEngine.name}</p><p>Fuel: ${launchFuel.toFixed(1)} t</p><p>Î”v: ${launchDV.toFixed(0)} m/s</p>`;
let output=`Total Î”v: ${totalDV.toFixed(0)} / ${requiredDV} m/s<br>`;
output+=`Total Mass: ${totalMass.toFixed(1)} t<br>`;
output+=`Launch TWR: ${TWR.toFixed(2)}<br>`;
output+=`Estimated Rocket Height: ${length.toFixed(1)} m<br><br>`;
output+=(totalDV>=requiredDV && TWR>1.3)?"<span class='good'>âœ” Mission Capable</span>":"<span class='bad'>âš  Adjust Design</span>";
document.getElementById("output").innerHTML=output;
document.getElementById("aiAdvice").innerHTML="<b>ðŸ§  Flight AI:</b><br>" + aiMessage;
}

function calculateFuel(engine,payload,targetDV){
let dryMass=payload+engine.mass;
let fuel=0.5;
while(fuel < 20000){
let fullMass=dryMass+fuel;
let dv=engine.isp*g*Math.log(fullMass/dryMass);
if(dv>=targetDV) return fuel;
fuel+=0.5;
}
return fuel;
}

function runTests(){
console.assert(document.getElementById("mission").options.length > 10, "Mission profiles not expanded");
console.assert(getAvailableEngines().length > 0, "Tier filtering failed");
let fuelNeeded = calculateFuel(engines[0],10,500);
console.assert(fuelNeeded > 0, "Fuel calculation failed");
}

runTests();
</script>

<div style="position:fixed;bottom:10px;right:15px;opacity:0.4;font-size:12px;pointer-events:none;">Made by Black0ut</div>
</body>
</html>
